<div id="v-synth">
    <sly-style>
        .beautiful-table { border-collapse: collapse; }
        .beautiful-table tr:nth-child(2n) { background-color: #f6f8fa; }
        .beautiful-table td, .beautiful-table th {
        border: 1px solid #dfe2e5;
        padding: 6px 13px;
        text-align: center;
        line-height: 20px;
        }
        .beautiful-table.al td, .beautiful-table.al th {
        text-align: left;
        }



    </sly-style>


    <sly-card title="Input Project" subtitle="Original data remains unchanged, new project will be created">
        <sly-field title="" description="Input Data">
            <a slot="title" target="_blank"
               :href="`/projects/${data.projectId}/datasets`">{{ data.projectName }} ({{ data.projectItemsCount }}
                images)</a>
            <sly-icon slot="icon" :options="{ imageUrl: `${data.projectPreviewUrl}` }"/>
        </sly-field>
    </sly-card>
    <div class="fflex mt15" style="align-items: stretch">
        <sly-card class="mr15" title="Select Background">


            <sly-select-team-workspace
                    :team-id.sync="state.bgTeamId"
                    :workspace-id.sync="state.bgWorkspaceId">
            </sly-select-team-workspace>
            <sly-select-project
                    :workspace-id="state.bgWorkspaceId"
                    :project-id.sync="state.bgProjectId">
            </sly-select-project>

            <el-checkbox class="mt15" v-model="state.allDatasets">All datasets</el-checkbox>
            <sly-select-dataset
                    v-show="!state.allDatasets"
                    :project-id="state.bgProjectId"
                    :datasets.sync="state.bgDatasets"
                    :options="{'multiple': true}">
            </sly-select-dataset>

        </sly-card>

        <sly-card title="Select objects" subtitle="Select objects for further processing" style="width: 100%; height:440px">
            <table class="beautiful-table" style="width: 100%">
                <thead>
                <tr>
                    <th v-for="col in data.myColumns">
                        <div v-html="col['title']"></div>
                        <div style="color: #7f858e; font-weight: normal; font-size: 12px;">
                            {{ col["subtitle"] }}
                        </div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr v-for="(row, row_index) in data.myRows">
                    <td v-for="(col, col_index) in data.myColumns">
                        <div v-if="col.title === 'Selected'">
                            <el-checkbox v-model="state.classChecked[row['Name']]"></el-checkbox>
                        </div>
                        <div v-if="col.title === 'Name'">
                            {{ row[col.title] }}
                        </div>
                        <div v-if="col.title === 'Shape'">
                            <i class="zmdi zmdi-shape mr5"></i> {{ row[col.title] }}
                        </div>
                        <div v-if="col.title === 'Color'">
                            <i class="zmdi zmdi-circle mr5" :style="{color: row[col.title]}"></i> {{ row[col.title] }}
                        </div>
                        <div v-if="col.title === 'Count'">
                            <el-input-number v-model="state.classCounts[row.Name]" :min="0"
                                             size="small"></el-input-number>
                        </div>

                        <div v-if="col.title === 'Positive'">
                            <el-switch
                                    v-model="state.classIsPositive[row.Name]"
                                    on-text=""
                                    off-text=""
                                    disabled>
                            </el-switch>
                        </div>


                    </td>
                </tr>
                </tbody>
            </table>
        </sly-card>

    </div>

    <div class="fflex mt15" style="align-items: stretch">
        <sly-card class="mr15"
                  title="Settings"
                  subtitle="Synth params"
                  style="min-width: 310px; max-width: 310px;">


            <div class="mt10 mb10">
                <div><b>Objects possible speed by X</b></div>
                <div class="block">
                    <el-slider
                            v-model="state.speedInterval"
                            range
                            show-stops
                            :min="1"
                            :max="32">
                    </el-slider>
                </div>
            </div>
            <div class="mt10 mb10">
                <div><b>Objects possible overlay</b></div>

                <div class="block">
                    <el-slider
                            v-model="state.objectOverlayInterval"
                            range
                            show-stops
                            :min="0"
                            :max="1"
                            :step="0.1">

                    </el-slider>
                </div>
            </div>


            <sly-field style="margin-top: 15px;" title="MovementLaw" description="Select movement law(-s)">

                <div class="fflex align-start">
                    <el-checkbox v-model="state.linearLaw" class="mt10 mr10"/>
                    <sly-field class="mt20" title="Linear"
                               description="Move objects by line">
                    </sly-field>
                </div>

                <div class="fflex align-start">
                    <el-checkbox v-model="state.randomLaw" class="mt10 mr10"/>
                    <sly-field class="mt20" title="Random Y"
                               description="Move objects randomly">
                    </sly-field>
                </div>

            </sly-field>

            <div class="mt15 mb15">
                <div><b>Video FPS</b></div>
                <el-input-number class="mt5" v-model="state.fps" :min="10" :max="60"></el-input-number>
            </div>

            <div class="mt15 mb15">
                <div><b>Video duration (in seconds)</b></div>
                <el-input-number class="mt5" v-model="state.durationVideo" :min="1" :max="999"
                                 :step="10"></el-input-number>
            </div>


        </sly-card>
        <sly-card title="Preview"
                  subtitle="Preview vSynth result"
                  style="width: 100%">
            <div slot="header" class="mb10">
                <div><b style="font-size: 13px">Preview duration</b></div>
                <el-input-number class="mt5 mr15" v-model="state.durationPreview" :min="1" :max="10" size="small"></el-input-number>
                <el-button
                        type="primary"
                        @click="state.previewLoading = true; command('preview')"
                        :loading="state.previewLoading"
                        :disabled="data.resProjectId || data.started || !state.bgProjectId"
                >
                    <i class="zmdi zmdi-slideshow" style="margin-right: 5px"></i> Preview
                </el-button>
            </div>
            <video v-if="data.videoUrl" controls style="max-height: 650px; max-width: 100%;">

                <!--                <source src="http://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4" type="video/mp4">-->
                <source :src="data.videoUrl" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            <div v-if="!data.videoUrl && state.previewLoading === false">Press preview to watch demo video</div>
            <div v-if=""></div>

            <div class="fflex mt10" v-if="state.previewLoading === true" style="align-items: baseline;">
                <div class="mr10" style="width: 120px;">{{ data.progressPreviewMessage }}:</div>
                <el-progress :percentage="data.progressPreview" style="flex: 1"></el-progress>
                <div class="ml10" style="flex: none;">[{{ data.progressPreviewCurrent }}
                    / {{ data.progressPreviewTotal }}]
                </div>
            </div>
        </sly-card>
    </div>

    <sly-card class="mt15"
              title="Output Project"
              subtitle="Define result project name, press Run and monitor progress">
        <sly-field title="Result project name">
            <el-input v-model="state.resProjectName"></el-input>
            <el-button class="mt10" type="primary" :loading="data.started"
                       :disabled="data.resProjectId || !state.bgProjectId"
                       @click="data.started = true; command('synthesize')">
                Synthesize
            </el-button>
        </sly-field>

        <div style="margin-top: 30px;">
            <sly-field class="mt15"
                       v-if="data.resProjectId && !data.started"
                       title="New project has been created"
                       description="Synthesize configuration is saved in project info (metadata) as json">
                <sly-field title="" description="Project">
                    <a slot="title" target="_blank"
                       :href="`/projects/${data.resProjectId}/datasets`">{{ data.resProjectName }}</a>
                    <sly-icon slot="icon" :options="{ imageUrl: `${data.resProjectPreviewUrl}` }"/>
                </sly-field>
            </sly-field>
        </div>
        <div class="fflex mt10" v-if="data.started === true">
            <div class="mr10" style="width: 120px;">{{ data.progressSynthMessage }}:</div>
            <el-progress class="mt10" v-if="data.started === true" :percentage="data.progressSynth"
                         style="flex: 1"></el-progress>
            <div class="ml10" style="flex: none;">[{{ data.progressSynthCurrent }} / {{ data.progressSynthTotal }}]
            </div>
        </div>
    </sly-card>
</div>