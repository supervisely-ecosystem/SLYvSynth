<sly-card
        title="Download data"
        subtitle="Download images and annotations from server to local app directory"
        :options="{collapsable: true}"
        :collapsed.sync="state.collapsed1"
        ref="step1"
>
    <sly-field title="" description="Project">
        <a slot="title" target="_blank"
           :href="`/projects/${data.projectId}/datasets`">{{ data.projectName }} ({{ data.projectImagesCount }}
            images)</a>
        <sly-icon slot="icon" :options="{ imageUrl: `${data.projectPreviewUrl}` }"/>
    </sly-field>


</sly-card>


<div class="fflex mt15 mb15" style="align-items: stretch" v-if="!state.collapsed1">
    <sly-card class="mr15" title="Select Background">


        <sly-select-team-workspace
                :team-id.sync="state.bgTeamId"
                :workspace-id.sync="state.bgWorkspaceId">
        </sly-select-team-workspace>
        <sly-select-project
                :workspace-id="state.bgWorkspaceId"
                :project-id.sync="state.bgProjectId">
        </sly-select-project>

        <el-checkbox class="mt15" v-model="state.allDatasets">All datasets</el-checkbox>
        <sly-select-dataset
                v-show="!state.allDatasets"
                :project-id="state.bgProjectId"
                :datasets.sync="state.bgDatasets"
                :options="{'multiple': true}">
        </sly-select-dataset>

    </sly-card>

    <sly-card title="Select objects" subtitle="Select a set of base primitives"
              style="width: 100%; height:440px">
        <table class="beautiful-table" style="width: 100%">
            <thead>
            <tr>
                <th v-for="col in data.myColumns">
                    <div v-html="col['title']"></div>
                    <div style="color: #7f858e; font-weight: normal; font-size: 12px;">
                        {{ col["subtitle"] }}
                    </div>
                </th>
            </tr>
            </thead>
            <tbody>
            <tr v-for="(row, row_index) in data.myRows">
                <td v-for="(col, col_index) in data.myColumns">
                    <div v-if="col.title === 'Selected'">
                        <el-checkbox v-model="state.classChecked[row['Name']]"></el-checkbox>
                    </div>
                    <div v-if="col.title === 'Name'">
                        {{ row[col.title] }}
                    </div>
                    <div v-if="col.title === 'Shape'">
                        <i class="zmdi zmdi-shape mr5"></i> {{ row[col.title] }}
                    </div>
                    <div v-if="col.title === 'Color'">
                        <i class="zmdi zmdi-circle mr5" :style="{color: row[col.title]}"></i> {{ row[col.title] }}
                    </div>
                    <div v-if="col.title === 'Count'">
                        <el-input-number v-model="state.classCounts[row.Name]" :min="0"
                                         size="small"></el-input-number>
                    </div>

                    <div v-if="col.title === 'Positive'">
                        <el-switch
                                v-model="state.classIsPositive[row.Name]"
                                on-text=""
                                off-text=""
                                disabled>
                        </el-switch>
                    </div>


                </td>
            </tr>
            </tbody>
        </table>

    </sly-card>


</div>

<div class="fflex mt25 mb15" style="width: 100%;">
    <sly-card style="width: 100%;">
        <el-button
                type="primary"
                class="regular"
                :disabled="!state.bgProjectId || (!state.allDatasets && !(state.bgDatasets.length > 0))"
                :loading="data.step1Loading"
                @click="command('download_project')"
                v-if="!data.done1">
            Download


        </el-button>

        <div v-if="data.step1Loading" class="fflex mt10" style="align-items: baseline;">

            <div class="mr10" style="width: 120px;">{{ data.progress1Message }}:</div>
            <el-progress :percentage="data.progress1" style="flex: 1"></el-progress>
            <div class="ml10" style="flex: none;">[{{ data.progress1Current }}
                / {{ data.progress1Total }}]
            </div>

        </div>

    <div v-if="data.done1">
        <i class="zmdi zmdi-check-circle mr5" style="color: #13ce66"></i>
        <span style="color: #5a6772;">Data has been successfully downloaded</span>
    </div>
    </sly-card>
</div>

